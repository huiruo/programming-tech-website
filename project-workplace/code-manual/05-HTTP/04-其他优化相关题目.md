## 0.前端性能优化

> web 前端是应用服务器处理之前的部分，前端主要包括：HTML、CSS、javascript、image 等各种资源，针对不同的资源有不同的优化方式。
>
> 内容优化
>
> - 减少 HTTP 请求数。这条策略是最重要最有效的，因为一个完整的请求要经过 DNS 寻址，与服务器建立连接，发送数据，等待服务器响应，接收数据这样一个消耗时间成本和资源成本的复杂的过程。
> - 使用字体图标，少用背景图片图片
>
> 常见方法：合并多个 CSS 文件和 js 文件，利用 CSS Sprites 整合图像，Inline Images (使用 data：URL scheme 在实际的页面嵌入图像数据 )，合理设置 HTTP 缓存等。
>
> - 减少 DNS 查找
> - 避免重定向
> - 使用 Ajax 缓存
> - 延迟加载组件，预加载组件
> - 减少 DOM 元素数量。页面中存在大量 DOM 元素，会导致 javascript 遍历 DOM 的效率变慢。
> - 最小化 iframe 的数量。iframes 提供了一个简单的方式把一个网站的内容嵌入到另一个网站中。但其创建速度比其他包括 JavaScript 和 CSS 的 DOM 元素的创建慢了 1-2 个数量级。
> - 避免 404。HTTP 请求时间消耗是很大的，因此使用 HTTP 请求来获得一个没有用处的响应（例如 404 没有找到页面）是完全没有必要的，它只会降低用户体验而不会有一点好处。
>
> 服务器优化
>
> - 使用内容分发网络（CDN）。把网站内容分散到多个、处于不同地域位置的服务器上可以加快下载速度。
> - GZIP 压缩
> - 设置 ETag：ETags（Entity tags，实体标签）是 web 服务器和浏览器用于判断浏览器缓存中的内容和服务器中的原始内容是否匹配的一种机制。
> - 提前刷新缓冲区
> - 对 Ajax 请求使用 GET 方法
> - 避免空的图像 src
>
> Cookie 优化
>
> - 减小 Cookie 大小
> - 针对 Web 组件使用域名无关的 Cookie
>
> CSS 优化
>
> - 将 CSS 代码放在 HTML 页面的顶部
> - 避免使用 CSS 表达式
> - 使用 < link> 来代替 @import
> - 避免使用 Filters
>
> javascript 优化
>
> - 将 JavaScript 脚本放在页面的底部。
> - 将 JavaScript 和 CSS 作为外部文件来引用。
>
> 在实际应用中使用外部文件可以提高页面速度，因为 JavaScript 和 CSS 文件都能在浏览器中产生缓存。
>
> - 缩小 JavaScript 和 CSS
> - 删除重复的脚本
> - 最小化 DOM 的访问。使用 JavaScript 访问 DOM 元素比较慢。
> - 开发智能的事件处理程序
> - javascript 代码注意：谨慎使用 with，避免使用 eval Function 函数，减少作用域链查找。
>
> 图像优化
>
> - 优化图片大小
> - 通过 CSS Sprites 优化图片
> - 不要在 HTML 中使用缩放图片
> - favicon.ico 要小而且可缓存

## 1.1首屏时间、白屏时间,

Performance 接口可以获取到当前页面中与性能相关的信息。
该类型的对象可以通过调用只读属性 Window.performance 来获得。
白屏时间：

```text
performance.timing.responseStart - performance.timing.navigationStart
```

首屏时间

```text
window.onload = () => {
    new Date() - performance.timing.responseStart
}
```

14.移动端如何优化首页白屏时间过长 ? 
*雅虎军规,还有一些其他的移动端优化,还有离线包或者serviceworker之类的,还趁机问了下团队是采用哪种方案,也是离线包*



## **1.2.页面加载白屏的原因有哪些，以及如何监控白屏时间，如何优化**

> 从输入URL到页面展示，发生了什么？
> 1、首先从本地查找域名，有的话直接用hosts文件里的ip地址，否则查询DNS，得到ip地址
> 2、建立TCP连接——进行“三次握手”
> 3、客户端发送http请求
> 4、服务端处理，并返回结果给客户端
> 5、关闭TCP连接——需要“四次挥手”
> 6、浏览器收到结果，开始解析资源（JS、CSS、HTML），解析HTML生成的dom树，和同时解析css生成的cssom树结合生成渲染树
> 7、根据渲染树渲染页面
>
> **1、给script加 defer属性**
> defer是HTML5新增的属性。一旦script是defer延迟的，那么这个script将会被 **异步加载** ，不会马上执行.
>
> ```
> <script src="js/ss1.js" defer></script>
> ```
>
> **1.减少head里的css资源**
>
> **2.优化图片**
>
> 预加载和懒加载
>
> **3.服务器预渲染**
>
> **SPA首屏加载慢如何解决?**
> 答：安装动态懒加载所需插件；使用CDN资源。

## 1.3.script 标签的 defer 和 async 标签的作用与区别

> ```
> 　　1.<script src="example.js"></script>
> 
> 　　　没有defer或async属性，浏览器会立即加载并执行相应的脚本。也就是说在渲染script标签之后的文档之前，不等待后续加载的文档元素，读到就开始加载和执行，此举会阻塞后续文档的加载；
> 
> 　　2.<script async src="example.js"></script>
> 
> 　　   有了async属性，表示后续文档的加载和渲染与js脚本的加载和执行是并行进行的，即异步执行；
> 
> 　　3.<script defer src="example.js"></script>
> 
>          有了defer属性，加载后续文档的过程和js脚本的加载(此时仅加载不执行)是并行进行的(异步)，js脚本的执行需要等到文档所有元素解析完成之后，DOMContentLoaded事件触发执行之前。
> ```
>
> 



## 2.页面大量图片，如何优化加载，优化用户体验

1. 图片懒加载。在页面的未可视区域添加一个滚动事件，判断图片位置与浏览器顶端的距离与页面的距离，如果前者小于后者，优先加载。
2. 如果为幻灯片、相册等，可以使用图片预加载技术，将当前展示图片的前一张和后一张优先下载。
3. 如果图片为css图片，可以使用CSSsprite，SVGsprite等技术。
4. 如果图片过大，可以使用特殊编码的图片，加载时会先加载一张压缩的特别厉害的缩略图，以提高用户体验。
5. 如果图片展示区域小于图片的真实大小，应在服务器端根据业务需要先进行图片压缩，图片压缩后大小与展示一致。

## 3.js网络请求性能优化之防抖与节流

- 防抖(debounce)
  在函数需要频繁触发时，只有当有足够空闲的时间时，才执行一次。就好像在百度搜索时，每次输入之后都有联想词弹出，这个控制联想词的方法就不可能是输入框内容一改变就触发的，他一定是当你结束输入一段时间之后才会触发。
- 节流(thorttle)
  预定一个函数只有在大于等于执行周期时才执行，周期内调用不执行。就好像你在淘宝抢购某一件限量热卖商品时，你不断点刷新点购买，可是总有一段时间你点上是没有效果，这里就用到了节流，就是怕点的太快导致系统出现bug。
- 区别
  在发生持续触发事件时，防抖设置事件延迟并在空闲时间去触发事件，而节流则是隔一定的时间触发一次。

## 4.前端性能优化：

> 1.加载方面
> 2.压缩js和图片

## 其他杂

格式化金钱，每千分位加逗号

```js
function format(str) {
    let s = ''
    let count = 0
    for (let i = str.length - 1; i >= 0; i--) {
        s = str[i] + s
        count++
        if (count % 3 == 0 && i != 0) {
            s = ',' + s
        }
    }
    return s
}
function format(str) {
    return str.replace(/(\d)(?=(?:\d{3})+$)/g, '$1,')
}
```

去除所有空格

```text
str.replace(/\s/g, '')
```

去除两边空格

```text
str.replace(/^\s+|\s+$/g, '')
// 原生方法
str.trim()
```